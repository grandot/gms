<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>附近餐廳查詢</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    #map { height: 400px; width: 100%; margin-top: 1rem; }
    button { padding: 0.5rem 1rem; }
  </style>
</head>
<body>
  <h1>今天古亭附近有哪些店？</h1>
  <button id="search">送出查詢</button>
  <div id="results"></div>
  <div id="map"></div>

  <!-- ① 把 YOUR_ACTUAL_KEY 換成你真正的前端 Key -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4mPtK54SsBVpOWD9bYdlPd_DF8kuOApE&callback=initMap">
  </script>

  <script>
    let map, markers = [];
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 25.026, lng: 121.522 },
        zoom: 15
      });
    }

    document.getElementById("search").onclick = async () => {
      const res = await fetch("/api/bright-task", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          question: "今天古亭附近有哪些店",
          lat: 25.026,
          lng: 121.522
        })
      });
      const list = await res.json();
      const container = document.getElementById("results");
      container.innerHTML = "";
      markers.forEach(m => m.setMap(null));
      markers = [];

      list.forEach(place => {
        const p = document.createElement("p");
        p.textContent = `${place.name} — ${place.address}`;
        container.appendChild(p);

        const m = new google.maps.Marker({
          position: { lat: place.lat, lng: place.lng },
          map,
          title: place.name
        });
        markers.push(m);
      });
    };
  </script>
</body>
</html>
