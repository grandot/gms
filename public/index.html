<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>吃喝玩樂搜索 MVP 測試</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { font-size: 24px; }
    button { margin-bottom: 10px; padding: 6px 12px; }
    #places-list { list-style: none; padding: 0; }
    #places-list li { margin: 4px 0; }
    #map { width: 100%; height: 400px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>今天古亭附近有哪些店？</h1>
  <button id="btn">送出查詢</button>
  <ul id="places-list"></ul>
  <div id="map"></div>

  <!-- 引入 Google Maps JavaScript API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4mPtK54SsBVpOWD9bYdlPd_DF8kuOApE">
  </script>

  <script>
    let map;
    function initMap(center) {
      map = new google.maps.Map(document.getElementById('map'), {
        center: center,
        zoom: 15,
      });
    }

    document.getElementById('btn').onclick = async () => {
      const anonKey = prompt('請貼入你的 Supabase anon key:');
      if (!anonKey) return;

      const res = await fetch(
        'https://psygbalodgljzncoqynv.supabase.co/functions/v1/bright-task',
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + anonKey
          },
          body: JSON.stringify({ question: '今天古亭附近有哪些店', lat: 25.026, lng: 121.522 }),
        }
      );
      const places = await res.json();

      // 列表
      const ul = document.getElementById('places-list');
      ul.innerHTML = '';
      places.forEach(place => {
        const li = document.createElement('li');
        li.textContent = `${place.name} — ${place.address}`;
        ul.appendChild(li);
      });

      // 初始化地圖
      const center = { lat: 25.026, lng: 121.522 };
      initMap(center);

      // 直接使用 staticPlaces 中的 lat/lng
      places.forEach(place => {
        if (place.lat && place.lng) {
          new google.maps.Marker({
            map: map,
            position: { lat: place.lat, lng: place.lng },
            title: place.name
          });
        }
      });
    };
  </script>
</body>
</html>
